<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>king of the hill</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <link rel="icon" type="image/png" href="image.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #1a1b23;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            margin: 0;
            overflow: hidden;
        }

        .king-title {
            font-family: 'Anton', sans-serif; 
            font-size: 10vmin; 
            background: linear-gradient(to bottom, #ffd700 40%, #ff8c00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0.3vmin 0.3vmin 0px #8b4500) 
                    drop-shadow(0.6vmin 0.6vmin 0px #5e2f00);
            margin-bottom: 3vmin;
            letter-spacing: 0.05em;
            text-align: center;
            line-height: 1;
            transform: skew(-5deg); 
        }

        .content-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3vmin;
            width: 80%;
        }

        .token-image {
            width: 18vmin;
            height: 18vmin;
            background-color: #4a9c2d;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 1.5vmin;
            flex-shrink: 0;
        }

        .token-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 1.5vmin;
        }

        .arrow-icon {
            color: white;
            font-size: 10vmin;
            font-weight: bold;
        }

        .details {
            display: flex;
            flex-direction: column;
            gap: 1vmin;
            font-size: 2.5vmin;
        }

        .creator-line {
            display: flex;
            align-items: center;
            gap: 1vmin;
            color: #b0b3b8;
            font-size: 2.2vmin;
        }

        .pepe-icon {
            width: 4vmin;
            height: 4vmin;
            border-radius: 50%;
        }

        /* --- NEW COPY BUTTON STYLES --- */
        .address-pill {
            display: flex;
            align-items: center;
            gap: 0.5vmin;
            background-color: #2a2b35;
            padding: 0.4vmin 1vmin;
            border-radius: 0.5vmin;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative; /* For tooltip positioning */
            border: 1px solid #3a3b45;
        }

        .address-pill:hover {
            background-color: #3a3b45;
        }

        .username {
            color: #ffffff;
            font-weight: bold;
            font-family: monospace; /* Monospace looks better for addresses */
            font-size: 2vmin;
        }

        .copy-icon-svg {
            width: 2vmin;
            height: 2vmin;
            fill: #b0b3b8;
        }

        .tooltip {
            visibility: hidden;
            background-color: #4a9c2d;
            color: #fff;
            text-align: center;
            border-radius: 0.5vmin;
            padding: 0.5vmin 1vmin;
            position: absolute;
            z-index: 1;
            bottom: 125%; /* Position above the button */
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 1.8vmin;
            pointer-events: none;
            white-space: nowrap;
        }

        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -0.5vmin;
            border-width: 0.5vmin;
            border-style: solid;
            border-color: #4a9c2d transparent transparent transparent;
        }

        .address-pill:active .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        .address-pill.copied .tooltip {
             visibility: visible;
            opacity: 1;
        }
        /* --------------------------- */

        .market-cap-line {
            color: #4a9c2d;
            font-weight: bold;
            font-size: 3vmin;
        }
        
        .market-cap-value {
            color: #4a9c2d;
            text-shadow: none;
        }

        .badge {
            margin-left: 0.5vmin;
            font-size: 3vmin;
        }

        .replies-line {
            color: #b0b3b8;
            font-size: 2.2vmin;
        }

        .replies-value {
            color: #ffffff;
            font-weight: bold;
        }

        .token-name-line {
            font-size: 4vmin;
            font-weight: bold;
            margin-top: 0.5vmin;
            line-height: 1;
        }

        .ticker {
            color: #b0b3b8;
            font-weight: normal;
            font-size: 0.8em; 
        }

        /* Progress Bar Styles */
        .progress-container {
            margin-top: 1vmin;
            width: 100%;
            max-width: 40vmin;
        }

        .progress-label {
            color: #b0b3b8;
            font-size: 2vmin;
            margin-bottom: 0.3vmin;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            color: #4a9c2d;
            font-weight: bold;
            font-size: 2.2vmin;
        }

        .progress-bar-bg {
            width: 100%;
            height: 1.8vmin;
            background-color: #2a2b35;
            border-radius: 1vmin;
            overflow: hidden;
            position: relative;
            border: 0.1vmin solid #3a3b45;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a9c2d 0%, #5cb33a 50%, #6dd147 100%);
            border-radius: 1vmin;
            transition: width 0.5s ease;
            position: relative;
            box-shadow: 0 0 0.5vmin rgba(74, 156, 45, 0.5);
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.3) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-status {
            color: #b0b3b8;
            font-size: 1.8vmin;
            margin-top: 0.5vmin;
            text-align: center;
        }

        .migrated-badge {
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 0.5vmin rgba(255, 215, 0, 0.5);
        }
        
        #tokenMint, #statusLog, #solPriceDisplay, #priceDisplay { display: none; }
    </style>
</head>
<body>

    <div class="king-title">king of the hill</div>

    <div class="content-container">
        <div class="token-image">
            <span class="arrow-icon">â†‘</span>
        </div>
        <div class="details">
            <div class="creator-line">
                Created by 
                <img src="" alt="Creator" class="pepe-icon"> 
                <div class="address-pill" onclick="copyAddress()">
                    <span class="username" id="creatorAddressDisplay">...</span>
                    <svg class="copy-icon-svg" viewBox="0 0 24 24">
                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                    </svg>
                    <span class="tooltip" id="copyTooltip">Copied</span>
                </div>
            </div>
            <div class="market-cap-line">
                market cap: <span id="mcapDisplay" class="market-cap-value">Loading...</span> <span class="badge">[badge: ðŸ‘‘]</span>
            </div>
            <div class="replies-line">
                replies: <span class="replies-value">...</span>
            </div>
            <div class="token-name-line">
                ... <span class="ticker">...</span>
            </div>

            <div class="progress-container">
                <div class="progress-label">
                    <span>Bonding Curve Progress</span>
                    <span class="progress-percentage" id="progressPercent">0%</span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="progress-status" id="progressStatus">Loading...</div>
            </div>
        </div>
    </div>

    <input type="text" id="tokenMint">
    <div id="priceDisplay"></div>
    <div id="solPriceDisplay"></div>
    <div id="statusLog"></div>

    <script>
        // ==================================================================
        // ðŸ‘‡ CONFIGURATION
        // ==================================================================
        const SETTINGS = {
            tokenMint: "Nks7XP6RE6a4tmNsUaUoLNUyrJKUvmV1DPJQZp3pump",
            
            // Your Helius/Alchemy URL
            rpcUrl: "https://mainnet.helius-rpc.com/?api-key=464c3463-d991-4503-b3ea-bbc25fc1f103",

            tokenName: "higher",
            ticker: "HIGHER",
            
            creatorName: "DNdCj7DodzjQVYTQus5VimyaMgqiE7mGtPJFo6z4BhLM",
            repliesCount: "43", 

            tokenImage: "image.png",
            creatorImage: "https://pump.mypinata.cloud/ipfs/QmeSzchzEPqCU1jwTnsipwcBAeH7S4bmVvFGfF65iA1BY1?img-width=16&img-dpr=2&img-onerror=redirect"
        };
        // ==================================================================

        const { Connection, PublicKey } = solanaWeb3;
        const PUMP_PROGRAM = new PublicKey("6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P");
        
        // Bonding curve constants (with 6 decimals)
        const INITIAL_REAL_TOKEN_RESERVES = 793_100_000_000_000n; 

        // --- Apply Settings & Format Address ---
        document.getElementById('tokenMint').value = SETTINGS.tokenMint;
        
        // NEW: Format address to "Start...End"
        const fullAddress = SETTINGS.creatorName;
        const truncatedAddress = fullAddress.slice(0, 6) + '...' + fullAddress.slice(-4);
        document.getElementById('creatorAddressDisplay').innerText = truncatedAddress;

        document.querySelector('.token-name-line').innerHTML = `${SETTINGS.tokenName} <span class="ticker">[ticker: ${SETTINGS.ticker}]</span>`;
        document.querySelector('.replies-value').innerText = SETTINGS.repliesCount;
        document.querySelector('.pepe-icon').src = SETTINGS.creatorImage;

        if (SETTINGS.tokenImage) {
            const imgContainer = document.querySelector('.token-image');
            imgContainer.innerHTML = `<img src="${SETTINGS.tokenImage}">`;
            imgContainer.style.background = "transparent";
            imgContainer.style.border = "none";
        }

        // --- NEW: Copy Functionality ---
        function copyAddress() {
            navigator.clipboard.writeText(SETTINGS.creatorName).then(() => {
                const pill = document.querySelector('.address-pill');
                pill.classList.add('copied');
                
                // Remove the class after animation to allow re-triggering
                setTimeout(() => {
                    pill.classList.remove('copied');
                }, 1500);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        // --- Data Logic ---
        const connection = new Connection(SETTINGS.rpcUrl.includes("YOUR") ? "https://api.mainnet-beta.solana.com" : SETTINGS.rpcUrl, "confirmed");
        let solPrice = 200.0; 

        async function fetchSolPrice() {
            try {
                const response = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd");
                const data = await response.json();
                if (data && data.solana && data.solana.usd) {
                    solPrice = data.solana.usd;
                }
            } catch (err) { 
                console.log("Using fallback SOL price:", solPrice); 
            }
        }

        async function updateMarketCap() {
            const mcapDisplay = document.getElementById("mcapDisplay");
            const progressBar = document.getElementById("progressBar");
            const progressPercent = document.getElementById("progressPercent");
            const progressStatus = document.getElementById("progressStatus");

            try {
                const mintPubkey = new PublicKey(SETTINGS.tokenMint);
                const seed = new TextEncoder().encode("bonding-curve");
                const [bondingCurvePda] = await PublicKey.findProgramAddress([seed, mintPubkey.toBytes()], PUMP_PROGRAM);
                const accountInfo = await connection.getAccountInfo(bondingCurvePda);

                if (!accountInfo) { 
                    mcapDisplay.innerText = "Migrated";
                    progressBar.style.width = "100%";
                    progressPercent.innerHTML = '<span class="migrated-badge">âœ“ MIGRATED</span>';
                    progressStatus.innerHTML = '<span class="migrated-badge">Token has graduated to Raydium! ðŸš€</span>';
                    return;
                }
                
                const buffer = accountInfo.data;
                const view = new DataView(buffer.buffer, buffer.byteOffset, buffer.byteLength);
                const virtualTokenReserves = view.getBigUint64(8, true);
                const virtualSolReserves = view.getBigUint64(16, true);
                const realTokenReserves = view.getBigUint64(24, true);
                const realSolReserves = view.getBigUint64(32, true);
                
                const isComplete = view.getUint8(48) === 1;
                
                if (isComplete || virtualTokenReserves === 0n || realTokenReserves === 0n) {
                    mcapDisplay.innerText = "Migrated";
                    progressBar.style.width = "100%";
                    progressPercent.innerHTML = '<span class="migrated-badge">âœ“ MIGRATED</span>';
                    progressStatus.innerHTML = '<span class="migrated-badge">Token has graduated to PumpSwap! ðŸš€</span>';
                    return;
                }
                
                if (virtualTokenReserves === 0n) { 
                    mcapDisplay.innerText = "Migrated";
                    progressBar.style.width = "100%";
                    progressPercent.innerHTML = '<span class="migrated-badge">âœ“ MIGRATED</span>';
                    progressStatus.innerHTML = '<span class="migrated-badge">Token has graduated to Raydium! ðŸš€</span>';
                    return;
                }

                // Calculate market cap
                const vToken = Number(virtualTokenReserves) / 1_000_000;
                const vSol = Number(virtualSolReserves) / 1_000_000_000;
                const priceInSol = vSol / vToken;
                const priceInUsd = priceInSol * solPrice;
                const marketCap = priceInUsd * 1_000_000_000; 

                let formattedMcap = "";
                if (marketCap >= 1_000_000_000) formattedMcap = (marketCap / 1_000_000_000).toFixed(2) + "B";
                else if (marketCap >= 1_000_000) formattedMcap = (marketCap / 1_000_000).toFixed(2) + "M";
                else if (marketCap >= 1_000) formattedMcap = (marketCap / 1_000).toFixed(2) + "K";
                else formattedMcap = marketCap.toFixed(2);
                
                mcapDisplay.innerText = formattedMcap;

                // Calculate bonding curve progress
                const bondingProgress = realTokenReserves >= INITIAL_REAL_TOKEN_RESERVES ? 0 : 
                    (1 - (Number(realTokenReserves * 10000n / INITIAL_REAL_TOKEN_RESERVES) / 10000));
                const percentage = bondingProgress * 100;
                
                progressBar.style.width = percentage + "%";
                progressPercent.innerText = percentage.toFixed(1) + "%";
                
                const GRADUATION_MARKET_CAP = 90000; 
                const dollarToGraduate = Math.max(GRADUATION_MARKET_CAP - marketCap, 0);
                
                const currentSol = Number(realSolReserves) / 1_000_000_000;
                progressStatus.innerText = `${currentSol.toFixed(3)} SOL in bonding curve â€¢ $${Math.floor(dollarToGraduate).toLocaleString('en-US')} to graduate`;

            } catch (err) { 
                console.error(err); 
                mcapDisplay.innerText = "Error";
                progressStatus.innerText = "Unable to load progress data";
            }
        }

        fetchSolPrice();
        updateMarketCap();
        setInterval(updateMarketCap, 1000);
        setInterval(fetchSolPrice, 60000);
    </script>
</body>
</html>
