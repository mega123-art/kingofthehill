<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>King of the Hill - HIGHER</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: #1a1b23;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            margin: 0;
            overflow: hidden;
        }

        .king-title {
            font-family: 'Anton', sans-serif; 
            /* Reduced from 16vmin to 10vmin */
            font-size: 10vmin; 
            
            background: linear-gradient(to bottom, #ffd700 40%, #ff8c00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            
            filter: drop-shadow(0.3vmin 0.3vmin 0px #8b4500) 
                    drop-shadow(0.6vmin 0.6vmin 0px #5e2f00);
            
            /* Reduced margin */
            margin-bottom: 3vmin;
            letter-spacing: 0.05em;
            text-align: center;
            line-height: 1;
            transform: skew(-5deg); 
        }

        .content-container {
            display: flex;
            align-items: center;
            justify-content: center;
            /* Reduced gap */
            gap: 3vmin;
            width: 80%;
        }

        .token-image {
            /* Reduced from 30vmin to 18vmin */
            width: 18vmin;
            height: 18vmin;
            background-color: #4a9c2d;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 1.5vmin;
            flex-shrink: 0;
        }

        .token-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 1.5vmin;
        }

        .arrow-icon {
            color: white;
            /* Reduced from 20vmin to 10vmin */
            font-size: 10vmin;
            font-weight: bold;
        }

        .details {
            display: flex;
            flex-direction: column;
            gap: 1vmin;
            font-size: 2.5vmin;
        }

        .creator-line {
            display: flex;
            align-items: center;
            gap: 1vmin;
            color: #b0b3b8;
            /* Reduced font size */
            font-size: 2.2vmin;
        }

        .pepe-icon {
            /* Reduced icon size */
            width: 4vmin;
            height: 4vmin;
            border-radius: 50%;
        }

        .username {
            color: #ffffff;
            font-weight: bold;
            background-color: transparent;
            padding: 0;
        }

        .market-cap-line {
            color: #4a9c2d;
            font-weight: bold;
            /* Reduced font size */
            font-size: 3vmin;
        }
        
        .market-cap-value {
            color: #4a9c2d;
            text-shadow: none;
        }

        .badge {
            margin-left: 0.5vmin;
            font-size: 3vmin;
        }

        .replies-line {
            color: #b0b3b8;
            font-size: 2.2vmin;
        }

        .replies-value {
            color: #ffffff;
            font-weight: bold;
        }

        .token-name-line {
            /* Reduced from 6vmin to 4vmin */
            font-size: 4vmin;
            font-weight: bold;
            margin-top: 0.5vmin;
            line-height: 1;
        }

        .ticker {
            color: #b0b3b8;
            font-weight: normal;
            font-size: 0.8em; 
        }

        /* Progress Bar Styles */
        .progress-container {
            margin-top: 1vmin;
            width: 100%;
            /* Limit width slightly for cleaner look */
            max-width: 40vmin;
        }

        .progress-label {
            color: #b0b3b8;
            font-size: 2vmin;
            margin-bottom: 0.3vmin;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            color: #4a9c2d;
            font-weight: bold;
            font-size: 2.2vmin;
        }

        .progress-bar-bg {
            width: 100%;
            /* Reduced height */
            height: 1.8vmin;
            background-color: #2a2b35;
            border-radius: 1vmin;
            overflow: hidden;
            position: relative;
            border: 0.1vmin solid #3a3b45;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a9c2d 0%, #5cb33a 50%, #6dd147 100%);
            border-radius: 1vmin;
            transition: width 0.5s ease;
            position: relative;
            box-shadow: 0 0 0.5vmin rgba(74, 156, 45, 0.5);
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.3) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-status {
            color: #b0b3b8;
            font-size: 1.8vmin;
            margin-top: 0.5vmin;
            text-align: center;
        }

        .migrated-badge {
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 0.5vmin rgba(255, 215, 0, 0.5);
        }
        
        /* Hide utilities */
        #tokenMint, #statusLog, #solPriceDisplay, #priceDisplay { display: none; }
    </style>
</head>
<body>

    <div class="king-title">king of the hill</div>

    <div class="content-container">
        <div class="token-image">
            <span class="arrow-icon">â†‘</span>
        </div>
        <div class="details">
            <div class="creator-line">
                Created by 
                <img src="" alt="Creator" class="pepe-icon"> 
                <span class="username">...</span>
            </div>
            <div class="market-cap-line">
                market cap: <span id="mcapDisplay" class="market-cap-value">Loading...</span> <span class="badge">[badge: ðŸ‘‘]</span>
            </div>
            <div class="replies-line">
                replies: <span class="replies-value">...</span>
            </div>
            <div class="token-name-line">
                ... <span class="ticker">...</span>
            </div>

            <div class="progress-container">
                <div class="progress-label">
                    <span>Bonding Curve Progress</span>
                    <span class="progress-percentage" id="progressPercent">0%</span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="progress-status" id="progressStatus">Loading...</div>
            </div>
        </div>
    </div>

    <input type="text" id="tokenMint">
    <div id="priceDisplay"></div>
    <div id="solPriceDisplay"></div>
    <div id="statusLog"></div>

    <script>
        // ==================================================================
        // ðŸ‘‡ CONFIGURATION
        // ==================================================================
        const SETTINGS = {
            tokenMint: "ydDccyq66xKtfqn5bsRpfFXz4WeF4fh3bgQBx1npump",
            
            // Your Helius/Alchemy URL
            rpcUrl: "https://mainnet.helius-rpc.com/?api-key=9a8da134-4626-4efc-99ad-ada51ac9e844",

            tokenName: "higher",
            ticker: "HIGHER",
            
            creatorName: "6P9Pw",
            repliesCount: "43", 

            tokenImage: "https://images.pump.fun/coin-image/BPhNJnsEvyZQAhLbfSGbE82hLdxyd5USB6BSwaYWpump?variant=600x600&ipfs=bafybeifg6slgfuxr5f6kbmzviwyrdhf2fnxbtt2jxknosq6lqgfnxwpiay&src=https%3A%2F%2Fpump.mypinata.cloud%2Fipfs%2Fbafybeifg6slgfuxr5f6kbmzviwyrdhf2fnxbtt2jxknosq6lqgfnxwpiay",
            creatorImage: "https://pump.mypinata.cloud/ipfs/QmeSzchzEPqCU1jwTnsipwcBAeH7S4bmVvFGfF65iA1BY1?img-width=16&img-dpr=2&img-onerror=redirect"
        };
        // ==================================================================

        const { Connection, PublicKey } = solanaWeb3;
        const PUMP_PROGRAM = new PublicKey("6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P");
        
        // Bonding curve constants (with 6 decimals)
        const INITIAL_REAL_TOKEN_RESERVES = 793_100_000_000_000n; // 793.1M tokens (with 6 decimals)

        // --- Apply Settings ---
        document.getElementById('tokenMint').value = SETTINGS.tokenMint;
        document.querySelector('.username').innerText = SETTINGS.creatorName;
        document.querySelector('.token-name-line').innerHTML = `${SETTINGS.tokenName} <span class="ticker">[ticker: ${SETTINGS.ticker}]</span>`;
        document.querySelector('.replies-value').innerText = SETTINGS.repliesCount;
        document.querySelector('.pepe-icon').src = SETTINGS.creatorImage;

        if (SETTINGS.tokenImage) {
            const imgContainer = document.querySelector('.token-image');
            imgContainer.innerHTML = `<img src="${SETTINGS.tokenImage}">`;
            imgContainer.style.background = "transparent";
            imgContainer.style.border = "none";
        }

        // --- Data Logic ---
        const connection = new Connection(SETTINGS.rpcUrl.includes("YOUR") ? "https://api.mainnet-beta.solana.com" : SETTINGS.rpcUrl, "confirmed");
        let solPrice = 200.0; // Updated fallback price

        async function fetchSolPrice() {
            try {
                const response = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd");
                const data = await response.json();
                if (data && data.solana && data.solana.usd) {
                    solPrice = data.solana.usd;
                    console.log('SOL Price updated:', solPrice);
                }
            } catch (err) { 
                console.log("Using fallback SOL price:", solPrice); 
            }
        }

        async function updateMarketCap() {
            const mcapDisplay = document.getElementById("mcapDisplay");
            const progressBar = document.getElementById("progressBar");
            const progressPercent = document.getElementById("progressPercent");
            const progressStatus = document.getElementById("progressStatus");

            try {
                const mintPubkey = new PublicKey(SETTINGS.tokenMint);
                const seed = new TextEncoder().encode("bonding-curve");
                const [bondingCurvePda] = await PublicKey.findProgramAddress([seed, mintPubkey.toBytes()], PUMP_PROGRAM);
                const accountInfo = await connection.getAccountInfo(bondingCurvePda);

                if (!accountInfo) { 
                    mcapDisplay.innerText = "Migrated";
                    progressBar.style.width = "100%";
                    progressPercent.innerHTML = '<span class="migrated-badge">âœ“ MIGRATED</span>';
                    progressStatus.innerHTML = '<span class="migrated-badge">Token has graduated to Raydium! ðŸš€</span>';
                    return;
                }
                
                const buffer = accountInfo.data;
                const view = new DataView(buffer.buffer, buffer.byteOffset, buffer.byteLength);
                const virtualTokenReserves = view.getBigUint64(8, true);
                const virtualSolReserves = view.getBigUint64(16, true);
                const realTokenReserves = view.getBigUint64(24, true);
                const realSolReserves = view.getBigUint64(32, true);
                
                // Check if bonding curve is complete (byte offset 48, bool)
                const isComplete = view.getUint8(48) === 1;
                
                if (isComplete || virtualTokenReserves === 0n || realTokenReserves === 0n) {
                    mcapDisplay.innerText = "Migrated";
                    progressBar.style.width = "100%";
                    progressPercent.innerHTML = '<span class="migrated-badge">âœ“ MIGRATED</span>';
                    progressStatus.innerHTML = '<span class="migrated-badge">Token has graduated to PumpSwap! ðŸš€</span>';
                    return;
                }
                
                if (virtualTokenReserves === 0n) { 
                    mcapDisplay.innerText = "Migrated";
                    progressBar.style.width = "100%";
                    progressPercent.innerHTML = '<span class="migrated-badge">âœ“ MIGRATED</span>';
                    progressStatus.innerHTML = '<span class="migrated-badge">Token has graduated to Raydium! ðŸš€</span>';
                    return;
                }

                // Calculate market cap
                const vToken = Number(virtualTokenReserves) / 1_000_000;
                const vSol = Number(virtualSolReserves) / 1_000_000_000;
                const priceInSol = vSol / vToken;
                const priceInUsd = priceInSol * solPrice;
                const marketCap = priceInUsd * 1_000_000_000; 

                // Debug logging
                console.log('Market Cap Debug:', {
                    virtualTokenReserves: vToken.toFixed(2),
                    virtualSolReserves: vSol.toFixed(4),
                    priceInSol: priceInSol.toFixed(10),
                    priceInUsd: priceInUsd.toFixed(10),
                    solPrice: solPrice,
                    marketCap: marketCap.toFixed(2),
                    currentSOL: (Number(realSolReserves) / 1_000_000_000).toFixed(3),
                    solNeeded: (85 - Number(realSolReserves) / 1_000_000_000).toFixed(3),
                    dollarToGraduate: ((85 - Number(realSolReserves) / 1_000_000_000) * solPrice).toFixed(2)
                });

                let formattedMcap = "";
                if (marketCap >= 1_000_000_000) formattedMcap = (marketCap / 1_000_000_000).toFixed(2) + "B";
                else if (marketCap >= 1_000_000) formattedMcap = (marketCap / 1_000_000).toFixed(2) + "M";
                else if (marketCap >= 1_000) formattedMcap = (marketCap / 1_000).toFixed(2) + "K";
                else formattedMcap = marketCap.toFixed(2);
                
                mcapDisplay.innerText = formattedMcap;

                // Calculate bonding curve progress (GitHub gist formula)
                // Formula: progress = 1 - (realTokenReserves / INITIAL_REAL_TOKEN_RESERVES)
                const bondingProgress = realTokenReserves >= INITIAL_REAL_TOKEN_RESERVES ? 0 : 
                    (1 - (Number(realTokenReserves * 10000n / INITIAL_REAL_TOKEN_RESERVES) / 10000));
                const percentage = bondingProgress * 100;
                
                progressBar.style.width = percentage + "%";
                progressPercent.innerText = percentage.toFixed(1) + "%";
                
                // Calculate $ to graduate based on market cap needed to complete bonding curve
                // Graduation happens when bonding curve completes (all 793.1M tokens sold)
                // This happens at approximately 85 SOL raised, which at completion gives ~$90k market cap
                const GRADUATION_MARKET_CAP = 90000; // $90k market cap at graduation
                const dollarToGraduate = Math.max(GRADUATION_MARKET_CAP - marketCap, 0);
                
                const currentSol = Number(realSolReserves) / 1_000_000_000;
                progressStatus.innerText = `${currentSol.toFixed(3)} SOL in bonding curve â€¢ $${Math.floor(dollarToGraduate).toLocaleString('en-US')} to graduate`;

            } catch (err) { 
                console.error(err); 
                mcapDisplay.innerText = "Error";
                progressStatus.innerText = "Unable to load progress data";
            }
        }

        fetchSolPrice();
        updateMarketCap();
        setInterval(updateMarketCap, 1000);
        setInterval(fetchSolPrice, 60000);
    </script>
</body>
</html>
